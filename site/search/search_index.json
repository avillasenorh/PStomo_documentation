{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"PStomo documentation PStomo is a computer program for performing local earthquake and controlled source travel time tomography with simultaneous inversion for P- and S-wave velocity structure, hypocentral parameters or static corrections.","title":"Home"},{"location":"#pstomo-documentation","text":"PStomo is a computer program for performing local earthquake and controlled source travel time tomography with simultaneous inversion for P- and S-wave velocity structure, hypocentral parameters or static corrections.","title":"PStomo documentation"},{"location":"about/","text":"About PStomo PStomo is a seismic tomography program written in C that inverts first-arriving P (and S) wave arrival times to obtain a P (and S) wave velocity model. PStomo can use any combination of controlled sources (e.g. explosions) and natural sources (earthquakes). When using earthquakes, PStomo can jointly invert both for velocity structure and earthquake relocation. Authors The current version of PStomo has been developed by Ari Tryggvason, Department of Earth Sciences, Uppsala University, Uppsala, Sweden. The original program was created by Harley M. Benz at the U.S. Geological Survey. The finite difference algorithms were written by John Vidale, John Hole, Pascal Podvin and Isabel Lecomte (see the reference list). The (modified) LSQR algorithm was created by Paige and Saunders (1982). The (slightly modified) SVD algorithms are taken from Numerical Recipes in C (Press et al., 1988). Yao Zheng Shen created the algorithms for generating the output for computing the resolution matrix with LSQR (Yao, et al., 1999). Antonio Villase\u00f1or created initial versions of some of the GMT scripts used in the tutorial examples. License Choose a license such as MIT. References Benz, H. M., B.A. Chouet, P. B. Dawson, J. C. Lahr, R. A. Page, and J. A. Hole (1996). Three- dimensional P- and S-wave velocity structure of Redoubt Volcano, Alaska, J. geophys. Res., 101, 8111-8128. Hole, J. A. (1992). Nonlinear high-resolution three-dimensional seismic travel time tomography, J. geophys. Res., 97, 6553-6562. Hole, J. A., and B. C. Zelt (1995). 3-D finite-difference reflection traveltimes. Geophys. J. Int., 121, 427-434. Paige, C. C., and M. A. Saunders (1982). LSQR: An algorithm for sparse linear equations and sparse least squares. ACM Trans. Math. Software, 8, 43-71. Podvin, P., and I. Lecomte (1991). Finite difference computation of traveltimes in very contrasted velocity models. A massively parallel approach and its associated tools, Geophys. J. Int, 105, 271-284 Press, W. H., S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery (1988). Numerical recipes in C, Cambridge University Press. Tryggvason, A., and N. Linde (2006). Local earthquake (LE) tomography with joint inversion for P- and S-wave velocities using structural constraints. Geophys. Res. Lett., 33, L07303, doi:10.1029/2005GL025485. Wessel. P., and W. H. F. Smith (1998). New improved version of Generic Mapping Tools released. EOS Trans. Amer. Geophys. U., 79(47), 579. Yao, Z. S., R. G. Roberts, and A. Tryggvason (1999). Calculating resolution and covariance matrixes for seismic tomography with the LSQR method. Geophys. J. Int, 138, 886-894, doi:10.1046/j.1365-246x.1999.00925.x.","title":"About"},{"location":"about/#about-pstomo","text":"PStomo is a seismic tomography program written in C that inverts first-arriving P (and S) wave arrival times to obtain a P (and S) wave velocity model. PStomo can use any combination of controlled sources (e.g. explosions) and natural sources (earthquakes). When using earthquakes, PStomo can jointly invert both for velocity structure and earthquake relocation.","title":"About PStomo"},{"location":"about/#authors","text":"The current version of PStomo has been developed by Ari Tryggvason, Department of Earth Sciences, Uppsala University, Uppsala, Sweden. The original program was created by Harley M. Benz at the U.S. Geological Survey. The finite difference algorithms were written by John Vidale, John Hole, Pascal Podvin and Isabel Lecomte (see the reference list). The (modified) LSQR algorithm was created by Paige and Saunders (1982). The (slightly modified) SVD algorithms are taken from Numerical Recipes in C (Press et al., 1988). Yao Zheng Shen created the algorithms for generating the output for computing the resolution matrix with LSQR (Yao, et al., 1999). Antonio Villase\u00f1or created initial versions of some of the GMT scripts used in the tutorial examples.","title":"Authors"},{"location":"about/#license","text":"Choose a license such as MIT.","title":"License"},{"location":"about/#references","text":"Benz, H. M., B.A. Chouet, P. B. Dawson, J. C. Lahr, R. A. Page, and J. A. Hole (1996). Three- dimensional P- and S-wave velocity structure of Redoubt Volcano, Alaska, J. geophys. Res., 101, 8111-8128. Hole, J. A. (1992). Nonlinear high-resolution three-dimensional seismic travel time tomography, J. geophys. Res., 97, 6553-6562. Hole, J. A., and B. C. Zelt (1995). 3-D finite-difference reflection traveltimes. Geophys. J. Int., 121, 427-434. Paige, C. C., and M. A. Saunders (1982). LSQR: An algorithm for sparse linear equations and sparse least squares. ACM Trans. Math. Software, 8, 43-71. Podvin, P., and I. Lecomte (1991). Finite difference computation of traveltimes in very contrasted velocity models. A massively parallel approach and its associated tools, Geophys. J. Int, 105, 271-284 Press, W. H., S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery (1988). Numerical recipes in C, Cambridge University Press. Tryggvason, A., and N. Linde (2006). Local earthquake (LE) tomography with joint inversion for P- and S-wave velocities using structural constraints. Geophys. Res. Lett., 33, L07303, doi:10.1029/2005GL025485. Wessel. P., and W. H. F. Smith (1998). New improved version of Generic Mapping Tools released. EOS Trans. Amer. Geophys. U., 79(47), 579. Yao, Z. S., R. G. Roberts, and A. Tryggvason (1999). Calculating resolution and covariance matrixes for seismic tomography with the LSQR method. Geophys. J. Int, 138, 886-894, doi:10.1046/j.1365-246x.1999.00925.x.","title":"References"},{"location":"formats/","text":"File formats PStomo has 3 basic input files (in addition to the parameter file and the initial/starting model): station file : contains station coordinates in cartesian (flat Earth) projection source file : contains origin time and hypocenter of sources (earthquakes and/or controlled) in cartesian projection arrival time file : contains arrival times of P (and S) waves sorted by recording station Although it is not necessary, we follow this convention for naming the input files: all files have a .in extension all files begin with a common prefix, which is a short identifier of the project or region (e.g. ice for Iceland or ncal for Northern California) station file has the _stat suffix (e.g. ice_stat.in ) source file has the _src suffix (e.g. ice_src.in ) arrival time file has the _tt suffix (e.g. ice_tt.in ) Since we often have many more sources than stations, to reduce computing time inside PStomo travel times are calculated from the stations. Therefore the concept of source and receiver is reversed inside the code. Station list A station file contains lines with the following columns (one for each station): STATION_ID X Y Z MAX_DISTANCE NUMBER_ARRIVAL_TIMES USE_STATION FLAG STATION_CODE STATION_ID = numerical station ID (not passed to main) X = x coordinate in km Y = y coordinate in km Z = z coordinate in km (negative if above sea level) MAX_DISTANCE = distance (km) to furthest source recorded by this station (not passed to main) NUMBER_ARRIVAL_TIMES = number of arrival times for this station USE_STATION = use flag: 0 use, 1 do not use (WARNING: opposite to standard true/false convention) FLAG = additional flag (not passed to main) STATION_CODE = alphanumeric station code (not passed to main) 0 -33.59028 -4.31897 -0.79400 116.72459 1225 0 0 CADE 1 -42.17252 12.75307 -1.16000 150.92570 854 0 0 CBOL 2 -20.12271 2.41153 -2.21000 101.10428 2142 0 0 CCAN 3 -26.79712 2.82335 -2.06400 94.74211 1168 0 0 CCHO 4 -15.59873 9.43089 -2.10300 109.41433 827 0 0 CDIE 5 -33.25449 10.47509 -1.62600 111.62872 962 0 0 CDOS 6 -18.92852 12.64890 -2.11000 108.85104 762 0 0 CFOR Source locations A source file contains lines with the following columns (one for each source): SOURCE_ID YYMMDD HHMM SS.FF... X Y Z MAGNITUDE EVENT_TYPE EVENT_GROUP_ID FLAG SOURCE_ID = source number/ID (usually starts at 0 but not required?) YYMMDD = origin time year, month, and day for this source (WARNING: two-digit year) HHMM = origin time hour and minute for this source SS.FF... = origin time seconds and fractionary part (variable precision) X = x coordinate in km Y = y coordinate in km Z = z coordinate/focal depth in km (negative if above sea level) MAGNITUDE = event magnitude EVENT_TYPE = 0 for earthquakes, 1 for explosions (controlled source) EVENT_GROUP_ID = event group ID this source belongs to (if no event groups SOURCE_ID = EVENT_GROUP_ID ) FLAG = (passed to main but apparently not used) 0 040628 0342 29.90 -29.3320 9.4560 0.0000 1.90 0 0 0 1 040628 0423 48.20 -29.9220 9.0140 0.0000 1.90 0 1 0 2 040629 2125 53.40 -16.4760 13.3100 0.0000 2.70 0 2 0 3 040706 1855 57.60 -28.3670 2.8040 0.0000 1.70 0 3 0 4 040716 2152 3.70 -34.7100 15.7880 24.5000 1.60 0 4 0 5 040725 0059 41.60 -29.5290 9.2350 0.0000 1.80 0 5 0 6 040727 0514 10.60 -22.9390 18.6410 16.4000 2.40 0 6 0 7 040727 0514 44.40 -27.5580 13.5530 5.1000 2.60 0 7 0 8 040727 0531 10.50 -28.0430 15.2170 8.4000 1.80 0 8 0 9 040727 1747 38.80 -30.6180 5.6910 0.0000 1.40 0 9 0 10 040728 0029 27.00 -28.6480 9.0110 0.0000 1.60 0 10 0 11 040730 1111 51.00 -29.1360 9.6770 0.0000 2.50 0 11 0 Arrival times The arrival time file contains two types of lines: Station line The arrival time file must begin with a station line and must contain exactly as many station lines as stations listed in the station file (and in the same order). STATION_CODE NUMBER_ARRIVAL_TIMES STATION_CODE = station code (program does not check that it coincides with code in station file) NUMBER_ARRIVAL_TIMES = number of arrival times for this station (this exact same of number of arrival time lines must follow this station line) Arrival time line SOURCE_ID YYMMDD HHMM P_SECOND P_WEIGHT P_USE S_SECOND S_WEIGHT S_USE SOURCE_ID = source ID in source file this arrival time belongs to YYMMDD = year, month and day of arrival time (WARNING: two-digit year) HHMM = hour and minute of arrival time P_SECOND = second of P-wave arrival time P_WEIGHT = weight of P-wave arrival time (HYPO71 convention: 0 = full weigth, > 3 = do not use) P_USE = flag for using this P phase: 0 = use, > 0 do not use (WARNING: opposite to standard true/false convention) S_SECOND = second of S-wave arrival time (can be greater than 60 s if S arrival time does not occur in same minute as P arrival time). If S phase is not present then S_SECOND = 0.0 and S_WEIGHT = S_USE = 9 . S_WEIGHT = weight of S-wave arrival time (HYPO71 convention: 0 = full weigth, > 3 = do not use) S_USE = flag for using this S phase: 0 = use, > 0 do not use (WARNING: opposite to standard true/false convention) Although the station file lists STATION_ID and STATION_CODE , these values are not used nor checked against the values in the arrival time file. Instead the program assumes that the stations in the arrival time file appear in exactly the same order as in the station file. However NUMBER_ARRIVAL_TIMES in the arrival time file and in the station file must be the same, and is verified by the program. CADE 1225 371 170401 1657 10.550 1 0 17.120 2 0 372 170406 2350 7.840 1 0 9.660 2 0 373 170408 0846 17.160 1 0 0.000 9 9 374 170623 2148 26.150 1 0 28.430 2 0 375 170410 0101 14.790 1 0 20.740 2 0 378 170421 0450 26.430 1 0 33.150 2 0 379 170422 1416 25.160 1 0 30.520 2 0 380 170423 1932 12.340 1 0 14.430 2 0 381 170424 0201 31.170 1 0 32.550 2 0 386 170513 0126 30.780 1 0 33.070 2 0 389 170523 0029 22.760 1 0 24.840 2 0 . . . 2223 200406 2219 54.000 1 0 55.910 2 0 2224 200407 0335 37.460 1 0 42.790 2 0 2225 200407 2359 52.180 1 0 53.150 2 0 2226 200408 0612 20.060 1 0 25.330 2 0 CBOL 854 330 160803 2230 50.560 1 0 57.750 2 0 331 160831 0734 26.290 1 0 34.960 2 0 332 160927 2347 53.610 1 0 61.520 2 0 335 161003 1340 49.230 1 0 58.740 2 0 . . . Velocity model Ray coverage Output travel times","title":"File formats"},{"location":"formats/#file-formats","text":"PStomo has 3 basic input files (in addition to the parameter file and the initial/starting model): station file : contains station coordinates in cartesian (flat Earth) projection source file : contains origin time and hypocenter of sources (earthquakes and/or controlled) in cartesian projection arrival time file : contains arrival times of P (and S) waves sorted by recording station Although it is not necessary, we follow this convention for naming the input files: all files have a .in extension all files begin with a common prefix, which is a short identifier of the project or region (e.g. ice for Iceland or ncal for Northern California) station file has the _stat suffix (e.g. ice_stat.in ) source file has the _src suffix (e.g. ice_src.in ) arrival time file has the _tt suffix (e.g. ice_tt.in ) Since we often have many more sources than stations, to reduce computing time inside PStomo travel times are calculated from the stations. Therefore the concept of source and receiver is reversed inside the code.","title":"File formats"},{"location":"formats/#station-list","text":"A station file contains lines with the following columns (one for each station): STATION_ID X Y Z MAX_DISTANCE NUMBER_ARRIVAL_TIMES USE_STATION FLAG STATION_CODE STATION_ID = numerical station ID (not passed to main) X = x coordinate in km Y = y coordinate in km Z = z coordinate in km (negative if above sea level) MAX_DISTANCE = distance (km) to furthest source recorded by this station (not passed to main) NUMBER_ARRIVAL_TIMES = number of arrival times for this station USE_STATION = use flag: 0 use, 1 do not use (WARNING: opposite to standard true/false convention) FLAG = additional flag (not passed to main) STATION_CODE = alphanumeric station code (not passed to main) 0 -33.59028 -4.31897 -0.79400 116.72459 1225 0 0 CADE 1 -42.17252 12.75307 -1.16000 150.92570 854 0 0 CBOL 2 -20.12271 2.41153 -2.21000 101.10428 2142 0 0 CCAN 3 -26.79712 2.82335 -2.06400 94.74211 1168 0 0 CCHO 4 -15.59873 9.43089 -2.10300 109.41433 827 0 0 CDIE 5 -33.25449 10.47509 -1.62600 111.62872 962 0 0 CDOS 6 -18.92852 12.64890 -2.11000 108.85104 762 0 0 CFOR","title":"Station list"},{"location":"formats/#source-locations","text":"A source file contains lines with the following columns (one for each source): SOURCE_ID YYMMDD HHMM SS.FF... X Y Z MAGNITUDE EVENT_TYPE EVENT_GROUP_ID FLAG SOURCE_ID = source number/ID (usually starts at 0 but not required?) YYMMDD = origin time year, month, and day for this source (WARNING: two-digit year) HHMM = origin time hour and minute for this source SS.FF... = origin time seconds and fractionary part (variable precision) X = x coordinate in km Y = y coordinate in km Z = z coordinate/focal depth in km (negative if above sea level) MAGNITUDE = event magnitude EVENT_TYPE = 0 for earthquakes, 1 for explosions (controlled source) EVENT_GROUP_ID = event group ID this source belongs to (if no event groups SOURCE_ID = EVENT_GROUP_ID ) FLAG = (passed to main but apparently not used) 0 040628 0342 29.90 -29.3320 9.4560 0.0000 1.90 0 0 0 1 040628 0423 48.20 -29.9220 9.0140 0.0000 1.90 0 1 0 2 040629 2125 53.40 -16.4760 13.3100 0.0000 2.70 0 2 0 3 040706 1855 57.60 -28.3670 2.8040 0.0000 1.70 0 3 0 4 040716 2152 3.70 -34.7100 15.7880 24.5000 1.60 0 4 0 5 040725 0059 41.60 -29.5290 9.2350 0.0000 1.80 0 5 0 6 040727 0514 10.60 -22.9390 18.6410 16.4000 2.40 0 6 0 7 040727 0514 44.40 -27.5580 13.5530 5.1000 2.60 0 7 0 8 040727 0531 10.50 -28.0430 15.2170 8.4000 1.80 0 8 0 9 040727 1747 38.80 -30.6180 5.6910 0.0000 1.40 0 9 0 10 040728 0029 27.00 -28.6480 9.0110 0.0000 1.60 0 10 0 11 040730 1111 51.00 -29.1360 9.6770 0.0000 2.50 0 11 0","title":"Source locations"},{"location":"formats/#arrival-times","text":"The arrival time file contains two types of lines:","title":"Arrival times"},{"location":"formats/#station-line","text":"The arrival time file must begin with a station line and must contain exactly as many station lines as stations listed in the station file (and in the same order). STATION_CODE NUMBER_ARRIVAL_TIMES STATION_CODE = station code (program does not check that it coincides with code in station file) NUMBER_ARRIVAL_TIMES = number of arrival times for this station (this exact same of number of arrival time lines must follow this station line)","title":"Station line"},{"location":"formats/#arrival-time-line","text":"SOURCE_ID YYMMDD HHMM P_SECOND P_WEIGHT P_USE S_SECOND S_WEIGHT S_USE SOURCE_ID = source ID in source file this arrival time belongs to YYMMDD = year, month and day of arrival time (WARNING: two-digit year) HHMM = hour and minute of arrival time P_SECOND = second of P-wave arrival time P_WEIGHT = weight of P-wave arrival time (HYPO71 convention: 0 = full weigth, > 3 = do not use) P_USE = flag for using this P phase: 0 = use, > 0 do not use (WARNING: opposite to standard true/false convention) S_SECOND = second of S-wave arrival time (can be greater than 60 s if S arrival time does not occur in same minute as P arrival time). If S phase is not present then S_SECOND = 0.0 and S_WEIGHT = S_USE = 9 . S_WEIGHT = weight of S-wave arrival time (HYPO71 convention: 0 = full weigth, > 3 = do not use) S_USE = flag for using this S phase: 0 = use, > 0 do not use (WARNING: opposite to standard true/false convention) Although the station file lists STATION_ID and STATION_CODE , these values are not used nor checked against the values in the arrival time file. Instead the program assumes that the stations in the arrival time file appear in exactly the same order as in the station file. However NUMBER_ARRIVAL_TIMES in the arrival time file and in the station file must be the same, and is verified by the program. CADE 1225 371 170401 1657 10.550 1 0 17.120 2 0 372 170406 2350 7.840 1 0 9.660 2 0 373 170408 0846 17.160 1 0 0.000 9 9 374 170623 2148 26.150 1 0 28.430 2 0 375 170410 0101 14.790 1 0 20.740 2 0 378 170421 0450 26.430 1 0 33.150 2 0 379 170422 1416 25.160 1 0 30.520 2 0 380 170423 1932 12.340 1 0 14.430 2 0 381 170424 0201 31.170 1 0 32.550 2 0 386 170513 0126 30.780 1 0 33.070 2 0 389 170523 0029 22.760 1 0 24.840 2 0 . . . 2223 200406 2219 54.000 1 0 55.910 2 0 2224 200407 0335 37.460 1 0 42.790 2 0 2225 200407 2359 52.180 1 0 53.150 2 0 2226 200408 0612 20.060 1 0 25.330 2 0 CBOL 854 330 160803 2230 50.560 1 0 57.750 2 0 331 160831 0734 26.290 1 0 34.960 2 0 332 160927 2347 53.610 1 0 61.520 2 0 335 161003 1340 49.230 1 0 58.740 2 0 . . .","title":"Arrival time line"},{"location":"formats/#velocity-model","text":"","title":"Velocity model"},{"location":"formats/#ray-coverage","text":"","title":"Ray coverage"},{"location":"formats/#output-travel-times","text":"","title":"Output travel times"},{"location":"parameters/","text":"Parameters Model parameters h = size of travel time basic cell, identical in the X, Y, and Z directions (km) magX = number of travel cells that a model cell has in the X direction magY = number of travel cells that a model cell has in the Y direction magZ = number of travel cells that a model cell has in the Z direction nx = number of model cells in the X direction ( xlen = nx * magX * h ) ny = number of model cells in the Y direction ( ylen = ny * magY * h ) nz = number of model cells in the Z direction ( zlen = nz * magZ * h ) baseElev = top of the model in km (negative if above sea level) xmin = left edge of the model in km (default = 0.0) (not implemented!) ymin = bottom edge of the model in km (default = 0.0) (not implemented!) Input files srcfil = station file (it is called \"src\" because stations are treated as sources in main code) recvfil = source file (it is called \"recv\" because sources are treated as receivers in main code) obfile = arrival time file velfile = binary file containing input/initial P-wave velocity model velfile_s = binary file containing input/initial S-wave velocity model Travel time parameters maxres = maximum P residual in seconds maxsres = maximum S residual in seconds Inversion parameters invert = flag to invert for velocity model: 1 = true, 0 = false smoother = smoothing constraint (small for rough model, high for smooth model) ilsqr = maximum number of LSQR iterations max_cond_num = maximum condition number for LSQR truncater = SVD truncater UVout_flg = flag to dump Ritz vectors to obtain resolution matrix: 1 = true, 0 = false reortho_flg = flag to reorthog. Ritz vectors (if UVout_flg = 1 ): 1 = true, 0 = false Earthquake parameters no_shots = flag to indicate that dataset contains no explosions: 1 = true (no explosions), 0 = false (explosions) no_earthq = flag to indicate that datasets contains no earthquakes: 1 = true (no earthquakes), 0 = false (earthquakes) min_z = Vp/Vs parameters swave_flg = use S waves flag: 1 = true, 0 = false vps_ratio = Vp/Vs ratio (a priori?, use to regularize?) ps_wght_type = P/S wave weight flag: 0 = do not weight P and S residuals, 1 = weight based on variance, 2 = fixed weight ps_wght = weight to use when ps_wght_type = 2 p_res_var Output files ttlog = flag to ouput file with computed travel times Traveltime.log : 1 = true, 0 = false eqinfo = flag to output file with hypocenter errors: 1 = true, 0 = false To sort xwt = ywt = zwt = magz_u = z_u_lim = magz_l = z_l_lim = rel_only = loc_only = relative = maxOffset = minOffset = errlog = reslog = raylog = msd = interpolate = min_z = max_dh = max_dt = app_var = detail = det_z = det_magz = reduce = red_z = red_magx = red_magy = red_magz = variable_sm = auto_cov_lim = maxsmooth = minsmooth = maxcover = mincover = lnsmooth = Podvin_Lecomte = Podvin_Lecomte_msg = shotstat = max_stat = velzone = velzone_tres = vps_ratio = cross_grad = cross_grad_horiz = cross_grad_wght = use_pert_file = perturb_file = perturb_file_s = cross_grad_ext = cross_grad_ext_horiz = xg_ext_file = cross_grad_ex_wght = cross_grad_ext_ons = cross_grad_ex_inv = out_jacob = out_res = NETtomo = NETmodel = reg_only = loc_pdf_use = loc_pdf_name = loc_pdf_nx = loc_pdf_ny = loc_pdf_nz = loc_pdf_dx = loc_pdf_dy = loc_pdf_dz = vel_pdf_use = vel_pdf_name = vel_pdf_nx = vel_pdf_ny = vel_pdf_nz = vel_pdf_dx = vel_pdf_dy = vel_pdf_dz =","title":"Parameters"},{"location":"parameters/#parameters","text":"","title":"Parameters"},{"location":"parameters/#model-parameters","text":"h = size of travel time basic cell, identical in the X, Y, and Z directions (km) magX = number of travel cells that a model cell has in the X direction magY = number of travel cells that a model cell has in the Y direction magZ = number of travel cells that a model cell has in the Z direction nx = number of model cells in the X direction ( xlen = nx * magX * h ) ny = number of model cells in the Y direction ( ylen = ny * magY * h ) nz = number of model cells in the Z direction ( zlen = nz * magZ * h ) baseElev = top of the model in km (negative if above sea level) xmin = left edge of the model in km (default = 0.0) (not implemented!) ymin = bottom edge of the model in km (default = 0.0) (not implemented!)","title":"Model parameters"},{"location":"parameters/#input-files","text":"srcfil = station file (it is called \"src\" because stations are treated as sources in main code) recvfil = source file (it is called \"recv\" because sources are treated as receivers in main code) obfile = arrival time file velfile = binary file containing input/initial P-wave velocity model velfile_s = binary file containing input/initial S-wave velocity model","title":"Input files"},{"location":"parameters/#travel-time-parameters","text":"maxres = maximum P residual in seconds maxsres = maximum S residual in seconds","title":"Travel time parameters"},{"location":"parameters/#inversion-parameters","text":"invert = flag to invert for velocity model: 1 = true, 0 = false smoother = smoothing constraint (small for rough model, high for smooth model) ilsqr = maximum number of LSQR iterations max_cond_num = maximum condition number for LSQR truncater = SVD truncater UVout_flg = flag to dump Ritz vectors to obtain resolution matrix: 1 = true, 0 = false reortho_flg = flag to reorthog. Ritz vectors (if UVout_flg = 1 ): 1 = true, 0 = false","title":"Inversion parameters"},{"location":"parameters/#earthquake-parameters","text":"no_shots = flag to indicate that dataset contains no explosions: 1 = true (no explosions), 0 = false (explosions) no_earthq = flag to indicate that datasets contains no earthquakes: 1 = true (no earthquakes), 0 = false (earthquakes) min_z =","title":"Earthquake parameters"},{"location":"parameters/#vpvs-parameters","text":"swave_flg = use S waves flag: 1 = true, 0 = false vps_ratio = Vp/Vs ratio (a priori?, use to regularize?) ps_wght_type = P/S wave weight flag: 0 = do not weight P and S residuals, 1 = weight based on variance, 2 = fixed weight ps_wght = weight to use when ps_wght_type = 2 p_res_var","title":"Vp/Vs parameters"},{"location":"parameters/#output-files","text":"ttlog = flag to ouput file with computed travel times Traveltime.log : 1 = true, 0 = false eqinfo = flag to output file with hypocenter errors: 1 = true, 0 = false","title":"Output files"},{"location":"parameters/#to-sort","text":"xwt = ywt = zwt = magz_u = z_u_lim = magz_l = z_l_lim = rel_only = loc_only = relative = maxOffset = minOffset = errlog = reslog = raylog = msd = interpolate = min_z = max_dh = max_dt = app_var = detail = det_z = det_magz = reduce = red_z = red_magx = red_magy = red_magz = variable_sm = auto_cov_lim = maxsmooth = minsmooth = maxcover = mincover = lnsmooth = Podvin_Lecomte = Podvin_Lecomte_msg = shotstat = max_stat = velzone = velzone_tres = vps_ratio = cross_grad = cross_grad_horiz = cross_grad_wght = use_pert_file = perturb_file = perturb_file_s = cross_grad_ext = cross_grad_ext_horiz = xg_ext_file = cross_grad_ex_wght = cross_grad_ext_ons = cross_grad_ex_inv = out_jacob = out_res = NETtomo = NETmodel = reg_only = loc_pdf_use = loc_pdf_name = loc_pdf_nx = loc_pdf_ny = loc_pdf_nz = loc_pdf_dx = loc_pdf_dy = loc_pdf_dz = vel_pdf_use = vel_pdf_name = vel_pdf_nx = vel_pdf_ny = vel_pdf_nz = vel_pdf_dx = vel_pdf_dy = vel_pdf_dz =","title":"To sort"},{"location":"tutorials/","text":"Tutorials 0. Setting up the Linux virtual machine A Linux virtual machine has been created to run the examples of local earthquake tomography processing. The file course.ova with the virtual machine (6.4 GB) can be downloaded from this link . To install and run the virtual machine the VirtualBox software in required. This software is free and is available for Windows, macOS and Linux computers. It can be downloaded in the VirtualBox home page. Once VirtualBox has been installed, it is possible to create the virtual machine using the file course.ova with the following steps: Open VirtualBox Go to the menu: File > Import Appliance Navigate to the directory where course.ova has been downloaded, select the file and click on Open and then Continue . The following window will appear: In this window you can change some settings, such as the name of the virtual machine, number of CPUs, and RAM. For now you can leave the default values and make those changes later. Click on Import to generate the virtual machine. This can take a few minutes depending on your computer. Once the virtual machine has been created, you can manage it in this window: If you have not changed the name, the virtual machine will appear as Ubuntu 16.04 . If you click on Settings you can modify the number of CPUs, amount of RAM, etc of the virtual maching. In order to run PStomo, 1 CPU is enough. With respect to RAM, a value between 1 GB and half the RAM of the computer is appropriate. Once you have modified the settings of the virtual machine, it can be started by clicking on Start (button with the green arrow). If the virtual maching has booted correctly, click on the icon of the Terminal application and run ls -l . The output on the screen shold be similar to this: Once started the virtual machine, it is useful to install the Guest Additions . Go to the menu Devices > Insert Guest Additions CD Image... . This will mount a virtual CD that will automatically run the installation of the Guest Additions . It will prompt the admin password of the virtual machine which is seismo . once installed the Guest Additions , eject the CD and reboot the virtual machine. This installation has to be done only once. 1. Selecting a region for tomography The first step for local earthquake tomography is to select the model region. This is done by adjusting the following parameters in the parameter file, that in our example is called lapalma_gradient_coarse.prm : # Origin of the local coordinates # lat0=28.65 # latitude of the origin of coordinates lon0=-17.85 # longitude of the origin of coordinates #angle= # rotation angle for oblique projection (undefined for standard Transverse Mercator) # # Boundaries of the map where the model region (box) is included (only needed for box.sh) # lat1=28.2 lat2=29.1 lon1=-18.35 lon2=-17.35 # # Box dimensions in km, referred to (lat0, lon0) # - For true center x2=-x1 and y2=-y1 # - For lower left corner make x1=y1=0 and x2=xlen, y2=ylen # x1=-20 x2=20.0 y1=-27.0 y2=27.0 baseElev=-3.0 # top of model (negative above sea level) zmax=45.0 # bottom of model In order to select the model volume for tomography we also need to plot the earthquakes and stations in our dataset. The station and bulletin (earthquakes and arrival times) files are specified in these parameters: # # Station and event files # stations=$topdir/stations/canarias_2022.sta bulletin=$topdir/bulletin/IGN_2013_present.nor format=nordic Once we have set the above parameters, we run the script box6.sh that plots the stations, earthquakes, and rectangular box using GMT : $ box6.sh lapalma_gradient_coarse.prm This generates a PostScript file called box.ps that can be visualized using for example gv : $ gv box.ps & The parameters that define the center of the model and the size of the box in x and y can be adjusted by trial and error until a suitable box is found such as the following: 2. Selecting earthquakes and arrival times for tomography Once a suitable model volume (box) has been obtained, we can select well recorded earthquakes for the tomography. This is done by setting the following block of parameters in the parameter file: # # Selection parameters for tomography # mag_min=-2.0 mag_max=9.9 rms_min=0.0 rms_max=2.0 p_phases_min=8 p_phases_max=9999 p_weight_best=0 p_weight_worst=3 s_phases_min=4 s_phases_max=9999 s_weight_best=0 s_weight_worst=3 distance_min=0.0 distance_max=350.0 gap_min=0 gap_max=200 close_station=1 use_s_waves=1 use_polarities=1 These parameters are described in more detailed in this link Once we have set the above parameters, we run the script let_selection.sh that runs the selection program seleq and writes the selected earthquakes in the format required by the tomography code pstomo_eq : $ let_selection.sh lapalma_gradient_coarse.prm This generates a PostScript file called dataset.ps that can be visualized using for example gv : $ gv dataset.ps & In addition to the PostScript file, the script let_selection.sh also generates 3 input files required by the tomography code: lapalma_src.in : file with earthquake (and explosion) hypocenters lapalma_stat.in : file with station coordinates lapalma_tt.in : file with P (and S) arrival times The format of these files is described in more detail in this link . 3. Running the tomography code To run the tomography code first we need to provide an initial 1D model. This is indicated in the following parameter: # Initial velocity model # initial_model=$topdir/1Dmodels/lapalma_gradient01.prm # full path so it also works in offset-and-average runs The format of the 1D model file is: -6.0 4.7 # first column is depth in km, second column is P-wave velocity 0.0 5.5 10.0 6.3 18.0 8.0 100.0 8.2 Then the following parameters indicate the version of the tomography code to run (always pstomo_eq ) and the number of iterations. If more than one run is specified in the parameter file (e.g. multiple values of smoothing) these can be run sequentially or in parallel (if the resources of the computer allow it). # # Parameters for tomography codes # tomo_code=pstomo_eq number_of_iterations=10 # number of iterations parallel=0 # run different smoothers sequentially or in parallel The following parameters control the size of the travel time and model grid: # # model parameters # h=0.3 # travel time grid spacing in km magx=10 # number of travel time cells for each model cell in X direction magy=10 # number of travel time cells for each model cell in Y direction magz=5 # number of travel time cells for each model cell in Z direction x_div=3 # number of divisions for offset and average in X direction y_div=3 # number of divisions for offset and average in Y direction z_div=3 # number of divisions for offset and average in Z direction The following parameters control the travel time computations: # # travel time parameters # maxres=0.75 # maximum allowed P residual (seconds) maxsres=1.50 # maximum allowed S residual (seconds) maxOffset=100.0 # maximum distance to calculate travel times (km) Podvin_Lecomte=1 The following parameters control the P and S travel time inversion parameters: # # P inversion parameters # invert=1 # invert velocity model (1=true, 0=false) interpolate=1 # interpolate model into travel time grid (1=true, 0=false) #smoother=\"100.0 75.0 50.0 40.0 30.0 20.0 10.0\" # list with different values of smoother to test smoother=\"10.0\" # list with different values of smoother to test # S inversion parameters # swave_flg=1 ps_wght_type=0 ps_wght=2.00 vpsreg_flg=1 vps_reg=50.0 vps_ratio=1.77 Finally the following parameters control the inversion parameter for earthquake relocations: # # earthquake inversion parameters # eqloc=1 # invert for earthquake relocations (1=true, 0=false) min_z=-0.5 # minimum depth (defined in seleq.in???) max_dh=5.0 # maximum allowed change in epicenter per iteration (km) max_dt=2.0 # maximum allowed change in origin time per iteration (seconds) no_earthq=0 no_shots=1 There are other parameters that affect the LSQR method used to invert the tomography matrix, but the default values are usually appropriate. A more detailed description of all the parameters is provided in this link Once we have set all these parameters, we run the tomography using the following command: $ let_run_pstomo.sh lapalma_gradient_coarse.prm & The output of each run is generated in a directory with the following naming schema: run_parfilename_smoother_xcellsize_ycellsize , where: parfilename is the prefix of the parameter file ( lapalma_gradient_coarse for the parameter file lapalma_gradient_coarse.prm . smoother is the value of the smoothing constraint used in this run (e.g. 010.0 for a smoothing value of 10.0) xcellsize is the size in km of the model cells in the X directory (03.00 for a cell size of 3.0 km) ycellsize is the size in km of the model cells in the Y directory An example of run directory then could be: run_lapalma_gradient_coarse_010.0_03.00_0.30 Inside this directory we can find the following files: pm.i : P model (in binary format) for iteration i . pc.i : P coverage (in binary format) for iteration i . sm.i : S model (in binary format) for iteration i . sc.i : S coverage (in binary format) for iteration i . src.i : Earthquake relocations for iteration i . log : log file with output of pstomo_eq 4. Displaying the results The script let_plot_pstomo.sh can be used to plot the results of the tomography. The syntax of the script is: $ let_plot_pstomo.sh parameter_file run_directory [ plot_type [ model [ iteration ] ] ] plot_type can be layer (default), profile , or profile_map model can be p (default) or s . iteration is the iteration to plot (default is the last iteration). This option can be useful to plot intermediate results before a long run finishes. This generates PostScript files in the run directory with the specified plots. These PostScript files can be visualized with gv . Example 1. Local earthquake tomography Example 2. Cross-hole tomography Example 3. Traveltime tomography with statics Example of a complete parameter file # File: la_palma_gradient_coarse.prm # Parameters to adjust the study region # Prefix for filenames related to this dataset # topdir=${HOME}/Projects/LET/La_Palma prefix=lapalma # prefix for selection and parameter files label=\"La Palma\" # title for plots # # Origin of the local coordinates (normally \"center\" of the model, or lower-left corner) # lat0=28.65 # latitude of the origin of coordinates lon0=-17.85 # longitude of the origin of coordinates #angle= # rotation angle for oblique projection (undefined for standard Transverse Mercator) # # Boundaries of the map where the model region (box) is included (only needed for box.sh) # lat1=28.2 lat2=29.1 lon1=-18.35 lon2=-17.35 # # Box dimensions in km, referred to (lat0, lon0) # - For true center x2=-x1 and y2=-y1 # - For lower left corner make x1=y1=0 and x2=xlen, y2=ylen # x1=-20 x2=20.0 y1=-27.0 y2=27.0 baseElev=-3.0 # top of model (negative above sea level) zmax=45.0 # bottom of model # # Selection dimension (can be smaller than box) # xs_1=$x1 xs_2=$x2 ys_1=$y1 ys_2=$y2 zs_1=0.5 zs_2=40.0 # # Map scale; used also to obtain geographical coordinates of the corners # #scale=\"1:5000000\" scale=16.0 # # Station and event files # stations=$topdir/stations/canarias_2022.sta bulletin=$topdir/bulletin/IGN_2013_present.nor format=nordic # topo_grid=$topdir/gridfiles/lapalma_03s.nc profiles=$topdir/profiles/W-E_profiles.list #profiles=$topdir/profiles/S-N_profiles.list # # Selection parameters for tomography # mag_min=-2.0 mag_max=9.9 rms_min=0.0 rms_max=2.0 p_phases_min=8 p_phases_max=9999 p_weight_best=0 p_weight_worst=3 s_phases_min=4 s_phases_max=9999 s_weight_best=0 s_weight_worst=3 distance_min=0.0 distance_max=350.0 gap_min=0 gap_max=200 close_station=1 use_s_waves=1 use_polarities=1 # # Initial velocity model # initial_model=$topdir/1Dmodels/lapalma_gradient01.prm # full path so it also works in offset-and-average runs # # Parameters for tomography codes # tomo_code=pstomo_eq number_of_iterations=10 # number of iterations parallel=0 # run different smoothers sequentially or in parallel # # model parameters # h=0.3 # travel time grid spacing in km magx=10 # number of travel time cells for each model cell in X direction magy=10 # number of travel time cells for each model cell in Y direction magz=5 # number of travel time cells for each model cell in Z direction x_div=3 # number of divisions for offset and average in X direction y_div=3 # number of divisions for offset and average in Y direction z_div=3 # number of divisions for offset and average in Z direction # # travel time parameters # maxres=0.75 # maximum allowed P residual (seconds) maxsres=1.50 # maximum allowed S residual (seconds) maxOffset=100.0 # maximum distance to calculate travel times (km) Podvin_Lecomte=1 # # P inversion parameters # invert=1 # invert velocity model (1=true, 0=false) interpolate=1 # interpolate model into travel time grid (1=true, 0=false) #smoother=\"100.0 75.0 50.0 40.0 30.0 20.0 10.0\" # list with different values of smoother to test smoother=\"10.0\" # list with different values of smoother to test # S inversion parameters # swave_flg=1 ps_wght_type=0 ps_wght=2.00 vpsreg_flg=1 vps_reg=50.0 vps_ratio=1.77 # # earthquake inversion parameters # eqloc=1 # invert for earthquake relocations (1=true, 0=false) min_z=-0.5 # minimum depth (defined in seleq.in???) max_dh=5.0 # maximum allowed change in epicenter per iteration (km) max_dt=2.0 # maximum allowed change in origin time per iteration (seconds) no_earthq=0 no_shots=1 # # output # verbose=1 ttlog=0 # output synthetic travel times (1=true, 0=false) eqinfo=0 # output log file with all travel time residuals (0=true, 1=false) timefile=0 # output travel time binary files for all stations (0=true, 1=false) # # LSQR # ilsqr=500 # number of LSQR iterations truncater=0.001 # SVD truncater for earthquake location max_cond_num=500.0 reortho_flg=0 UVout_flg=0 # # refine model with depth # detail=0 det_z=1.0 det_magz=2 reduce=0 red_z=3.0 red_magx=2 red_magy=2 red_magz=2 # # others # msd=0.0 # relative=0 cross_grad=1 cross_grad_wght=200.0 use_pert_file=0 # # not used # errlog=0 # output log file with unused travel times (0=true, 1=false) reslog=1 # output log file with all travel time residuals (0=true, 1=false) twght=0 # weight travel times by pick quality (0=true, 1=false) xwt=1.0 # weight factor of smoothing in X direction ywt=1.0 # weight factor of smoothing in X direction zwt=1.0 # weight factor of smoothing in X direction # # Parameters for checkerboard tests # synthetic_anomaly=10.0 # magnitude of synthetic spike anomaly (in %) x_spike=4 # size of spike in X direction (in cells) y_spike=4 # size of spike in Y direction (in cells) z_spike=4 # size of spike in Z direction (in cells) x_buffer=4 # number of cells with 0 anomaly between spikes in X direction y_buffer=4 # number of cells with 0 anomaly between spikes in Y direction z_buffer=4 # number of cells with 0 anomaly between spikes in Z direction x_offset=0 # extra offset of skipes in X direction (in cells) y_offset=0 # extra offset of skipes in Y direction (in cells) z_offset=4 # extra offset of skipes in Z direction (in cells) # # GMT5 plotting parameters # start_layer=3 end_layer=20 paper_size=a4 cptdir=${HOME}/data/cpt p_cpt=$cptdir/16%_panoply.cpt s_cpt=$cptdir/16%_panoply.cpt vpvs_cpt=$cptdir/vpvs_drywet.cpt pc_cpt=$cptdir/hitc_20.cpt sc_cpt=$cptdir/hitc_20.cpt orientation=\"-P\" features=\"-Df -A10/1/1 -W0.5p -N2/0.5p,gray,- -L-17.72/28.48/$lat0/10\" include_plot=$topdir/geology/faults.sh xa=0.2 xt=0.1 xg=0 ya=0.2 yt=0.1 yg=0 axis=WeSn sta_symbol=\"-St0.15c -L -W0.25p,0/0/255\" sta_bad_symbol=\"-Si0.15c -L -G0\" eq_symbol=\"-Sc0.07c -L -W0.25p,255/0/0\" eq_bad_symbol=\"-Sc0.07c -L -W0.25p,255/100/255\" ex_symbol=\"-Sx0.07c -L -W0.25p,255/0/255\" gmt_verbose= # # vertical cross sections # dp=0.2 pwidth=10.0 offset=5.0 ha=10 ht=5 va=10 vt=5 p_cpt_absolute=$cptdir/vp_crimson3.cpt s_cpt_absolute=$cptdir/vs.cpt topo_cpt=$cptdir/dp5.cpt eq_symbol1=\"-Sc0.1c -L -W0.25p,255 -G0\" sta_symbol1=\"-Si0.2c -L -W0.25p -G255/0/255\"","title":"Tutorials"},{"location":"tutorials/#tutorials","text":"","title":"Tutorials"},{"location":"tutorials/#0-setting-up-the-linux-virtual-machine","text":"A Linux virtual machine has been created to run the examples of local earthquake tomography processing. The file course.ova with the virtual machine (6.4 GB) can be downloaded from this link . To install and run the virtual machine the VirtualBox software in required. This software is free and is available for Windows, macOS and Linux computers. It can be downloaded in the VirtualBox home page. Once VirtualBox has been installed, it is possible to create the virtual machine using the file course.ova with the following steps: Open VirtualBox Go to the menu: File > Import Appliance Navigate to the directory where course.ova has been downloaded, select the file and click on Open and then Continue . The following window will appear: In this window you can change some settings, such as the name of the virtual machine, number of CPUs, and RAM. For now you can leave the default values and make those changes later. Click on Import to generate the virtual machine. This can take a few minutes depending on your computer. Once the virtual machine has been created, you can manage it in this window: If you have not changed the name, the virtual machine will appear as Ubuntu 16.04 . If you click on Settings you can modify the number of CPUs, amount of RAM, etc of the virtual maching. In order to run PStomo, 1 CPU is enough. With respect to RAM, a value between 1 GB and half the RAM of the computer is appropriate. Once you have modified the settings of the virtual machine, it can be started by clicking on Start (button with the green arrow). If the virtual maching has booted correctly, click on the icon of the Terminal application and run ls -l . The output on the screen shold be similar to this: Once started the virtual machine, it is useful to install the Guest Additions . Go to the menu Devices > Insert Guest Additions CD Image... . This will mount a virtual CD that will automatically run the installation of the Guest Additions . It will prompt the admin password of the virtual machine which is seismo . once installed the Guest Additions , eject the CD and reboot the virtual machine. This installation has to be done only once.","title":"0. Setting up the Linux virtual machine"},{"location":"tutorials/#1-selecting-a-region-for-tomography","text":"The first step for local earthquake tomography is to select the model region. This is done by adjusting the following parameters in the parameter file, that in our example is called lapalma_gradient_coarse.prm : # Origin of the local coordinates # lat0=28.65 # latitude of the origin of coordinates lon0=-17.85 # longitude of the origin of coordinates #angle= # rotation angle for oblique projection (undefined for standard Transverse Mercator) # # Boundaries of the map where the model region (box) is included (only needed for box.sh) # lat1=28.2 lat2=29.1 lon1=-18.35 lon2=-17.35 # # Box dimensions in km, referred to (lat0, lon0) # - For true center x2=-x1 and y2=-y1 # - For lower left corner make x1=y1=0 and x2=xlen, y2=ylen # x1=-20 x2=20.0 y1=-27.0 y2=27.0 baseElev=-3.0 # top of model (negative above sea level) zmax=45.0 # bottom of model In order to select the model volume for tomography we also need to plot the earthquakes and stations in our dataset. The station and bulletin (earthquakes and arrival times) files are specified in these parameters: # # Station and event files # stations=$topdir/stations/canarias_2022.sta bulletin=$topdir/bulletin/IGN_2013_present.nor format=nordic Once we have set the above parameters, we run the script box6.sh that plots the stations, earthquakes, and rectangular box using GMT : $ box6.sh lapalma_gradient_coarse.prm This generates a PostScript file called box.ps that can be visualized using for example gv : $ gv box.ps & The parameters that define the center of the model and the size of the box in x and y can be adjusted by trial and error until a suitable box is found such as the following:","title":"1. Selecting a region for tomography"},{"location":"tutorials/#2-selecting-earthquakes-and-arrival-times-for-tomography","text":"Once a suitable model volume (box) has been obtained, we can select well recorded earthquakes for the tomography. This is done by setting the following block of parameters in the parameter file: # # Selection parameters for tomography # mag_min=-2.0 mag_max=9.9 rms_min=0.0 rms_max=2.0 p_phases_min=8 p_phases_max=9999 p_weight_best=0 p_weight_worst=3 s_phases_min=4 s_phases_max=9999 s_weight_best=0 s_weight_worst=3 distance_min=0.0 distance_max=350.0 gap_min=0 gap_max=200 close_station=1 use_s_waves=1 use_polarities=1 These parameters are described in more detailed in this link Once we have set the above parameters, we run the script let_selection.sh that runs the selection program seleq and writes the selected earthquakes in the format required by the tomography code pstomo_eq : $ let_selection.sh lapalma_gradient_coarse.prm This generates a PostScript file called dataset.ps that can be visualized using for example gv : $ gv dataset.ps & In addition to the PostScript file, the script let_selection.sh also generates 3 input files required by the tomography code: lapalma_src.in : file with earthquake (and explosion) hypocenters lapalma_stat.in : file with station coordinates lapalma_tt.in : file with P (and S) arrival times The format of these files is described in more detail in this link .","title":"2. Selecting earthquakes and arrival times for tomography"},{"location":"tutorials/#3-running-the-tomography-code","text":"To run the tomography code first we need to provide an initial 1D model. This is indicated in the following parameter: # Initial velocity model # initial_model=$topdir/1Dmodels/lapalma_gradient01.prm # full path so it also works in offset-and-average runs The format of the 1D model file is: -6.0 4.7 # first column is depth in km, second column is P-wave velocity 0.0 5.5 10.0 6.3 18.0 8.0 100.0 8.2 Then the following parameters indicate the version of the tomography code to run (always pstomo_eq ) and the number of iterations. If more than one run is specified in the parameter file (e.g. multiple values of smoothing) these can be run sequentially or in parallel (if the resources of the computer allow it). # # Parameters for tomography codes # tomo_code=pstomo_eq number_of_iterations=10 # number of iterations parallel=0 # run different smoothers sequentially or in parallel The following parameters control the size of the travel time and model grid: # # model parameters # h=0.3 # travel time grid spacing in km magx=10 # number of travel time cells for each model cell in X direction magy=10 # number of travel time cells for each model cell in Y direction magz=5 # number of travel time cells for each model cell in Z direction x_div=3 # number of divisions for offset and average in X direction y_div=3 # number of divisions for offset and average in Y direction z_div=3 # number of divisions for offset and average in Z direction The following parameters control the travel time computations: # # travel time parameters # maxres=0.75 # maximum allowed P residual (seconds) maxsres=1.50 # maximum allowed S residual (seconds) maxOffset=100.0 # maximum distance to calculate travel times (km) Podvin_Lecomte=1 The following parameters control the P and S travel time inversion parameters: # # P inversion parameters # invert=1 # invert velocity model (1=true, 0=false) interpolate=1 # interpolate model into travel time grid (1=true, 0=false) #smoother=\"100.0 75.0 50.0 40.0 30.0 20.0 10.0\" # list with different values of smoother to test smoother=\"10.0\" # list with different values of smoother to test # S inversion parameters # swave_flg=1 ps_wght_type=0 ps_wght=2.00 vpsreg_flg=1 vps_reg=50.0 vps_ratio=1.77 Finally the following parameters control the inversion parameter for earthquake relocations: # # earthquake inversion parameters # eqloc=1 # invert for earthquake relocations (1=true, 0=false) min_z=-0.5 # minimum depth (defined in seleq.in???) max_dh=5.0 # maximum allowed change in epicenter per iteration (km) max_dt=2.0 # maximum allowed change in origin time per iteration (seconds) no_earthq=0 no_shots=1 There are other parameters that affect the LSQR method used to invert the tomography matrix, but the default values are usually appropriate. A more detailed description of all the parameters is provided in this link Once we have set all these parameters, we run the tomography using the following command: $ let_run_pstomo.sh lapalma_gradient_coarse.prm & The output of each run is generated in a directory with the following naming schema: run_parfilename_smoother_xcellsize_ycellsize , where: parfilename is the prefix of the parameter file ( lapalma_gradient_coarse for the parameter file lapalma_gradient_coarse.prm . smoother is the value of the smoothing constraint used in this run (e.g. 010.0 for a smoothing value of 10.0) xcellsize is the size in km of the model cells in the X directory (03.00 for a cell size of 3.0 km) ycellsize is the size in km of the model cells in the Y directory An example of run directory then could be: run_lapalma_gradient_coarse_010.0_03.00_0.30 Inside this directory we can find the following files: pm.i : P model (in binary format) for iteration i . pc.i : P coverage (in binary format) for iteration i . sm.i : S model (in binary format) for iteration i . sc.i : S coverage (in binary format) for iteration i . src.i : Earthquake relocations for iteration i . log : log file with output of pstomo_eq","title":"3. Running the tomography code"},{"location":"tutorials/#4-displaying-the-results","text":"The script let_plot_pstomo.sh can be used to plot the results of the tomography. The syntax of the script is: $ let_plot_pstomo.sh parameter_file run_directory [ plot_type [ model [ iteration ] ] ] plot_type can be layer (default), profile , or profile_map model can be p (default) or s . iteration is the iteration to plot (default is the last iteration). This option can be useful to plot intermediate results before a long run finishes. This generates PostScript files in the run directory with the specified plots. These PostScript files can be visualized with gv .","title":"4. Displaying the results"},{"location":"tutorials/#example-1-local-earthquake-tomography","text":"","title":"Example 1. Local earthquake tomography"},{"location":"tutorials/#example-2-cross-hole-tomography","text":"","title":"Example 2. Cross-hole tomography"},{"location":"tutorials/#example-3-traveltime-tomography-with-statics","text":"","title":"Example 3. Traveltime tomography with statics"},{"location":"tutorials/#example-of-a-complete-parameter-file","text":"# File: la_palma_gradient_coarse.prm # Parameters to adjust the study region # Prefix for filenames related to this dataset # topdir=${HOME}/Projects/LET/La_Palma prefix=lapalma # prefix for selection and parameter files label=\"La Palma\" # title for plots # # Origin of the local coordinates (normally \"center\" of the model, or lower-left corner) # lat0=28.65 # latitude of the origin of coordinates lon0=-17.85 # longitude of the origin of coordinates #angle= # rotation angle for oblique projection (undefined for standard Transverse Mercator) # # Boundaries of the map where the model region (box) is included (only needed for box.sh) # lat1=28.2 lat2=29.1 lon1=-18.35 lon2=-17.35 # # Box dimensions in km, referred to (lat0, lon0) # - For true center x2=-x1 and y2=-y1 # - For lower left corner make x1=y1=0 and x2=xlen, y2=ylen # x1=-20 x2=20.0 y1=-27.0 y2=27.0 baseElev=-3.0 # top of model (negative above sea level) zmax=45.0 # bottom of model # # Selection dimension (can be smaller than box) # xs_1=$x1 xs_2=$x2 ys_1=$y1 ys_2=$y2 zs_1=0.5 zs_2=40.0 # # Map scale; used also to obtain geographical coordinates of the corners # #scale=\"1:5000000\" scale=16.0 # # Station and event files # stations=$topdir/stations/canarias_2022.sta bulletin=$topdir/bulletin/IGN_2013_present.nor format=nordic # topo_grid=$topdir/gridfiles/lapalma_03s.nc profiles=$topdir/profiles/W-E_profiles.list #profiles=$topdir/profiles/S-N_profiles.list # # Selection parameters for tomography # mag_min=-2.0 mag_max=9.9 rms_min=0.0 rms_max=2.0 p_phases_min=8 p_phases_max=9999 p_weight_best=0 p_weight_worst=3 s_phases_min=4 s_phases_max=9999 s_weight_best=0 s_weight_worst=3 distance_min=0.0 distance_max=350.0 gap_min=0 gap_max=200 close_station=1 use_s_waves=1 use_polarities=1 # # Initial velocity model # initial_model=$topdir/1Dmodels/lapalma_gradient01.prm # full path so it also works in offset-and-average runs # # Parameters for tomography codes # tomo_code=pstomo_eq number_of_iterations=10 # number of iterations parallel=0 # run different smoothers sequentially or in parallel # # model parameters # h=0.3 # travel time grid spacing in km magx=10 # number of travel time cells for each model cell in X direction magy=10 # number of travel time cells for each model cell in Y direction magz=5 # number of travel time cells for each model cell in Z direction x_div=3 # number of divisions for offset and average in X direction y_div=3 # number of divisions for offset and average in Y direction z_div=3 # number of divisions for offset and average in Z direction # # travel time parameters # maxres=0.75 # maximum allowed P residual (seconds) maxsres=1.50 # maximum allowed S residual (seconds) maxOffset=100.0 # maximum distance to calculate travel times (km) Podvin_Lecomte=1 # # P inversion parameters # invert=1 # invert velocity model (1=true, 0=false) interpolate=1 # interpolate model into travel time grid (1=true, 0=false) #smoother=\"100.0 75.0 50.0 40.0 30.0 20.0 10.0\" # list with different values of smoother to test smoother=\"10.0\" # list with different values of smoother to test # S inversion parameters # swave_flg=1 ps_wght_type=0 ps_wght=2.00 vpsreg_flg=1 vps_reg=50.0 vps_ratio=1.77 # # earthquake inversion parameters # eqloc=1 # invert for earthquake relocations (1=true, 0=false) min_z=-0.5 # minimum depth (defined in seleq.in???) max_dh=5.0 # maximum allowed change in epicenter per iteration (km) max_dt=2.0 # maximum allowed change in origin time per iteration (seconds) no_earthq=0 no_shots=1 # # output # verbose=1 ttlog=0 # output synthetic travel times (1=true, 0=false) eqinfo=0 # output log file with all travel time residuals (0=true, 1=false) timefile=0 # output travel time binary files for all stations (0=true, 1=false) # # LSQR # ilsqr=500 # number of LSQR iterations truncater=0.001 # SVD truncater for earthquake location max_cond_num=500.0 reortho_flg=0 UVout_flg=0 # # refine model with depth # detail=0 det_z=1.0 det_magz=2 reduce=0 red_z=3.0 red_magx=2 red_magy=2 red_magz=2 # # others # msd=0.0 # relative=0 cross_grad=1 cross_grad_wght=200.0 use_pert_file=0 # # not used # errlog=0 # output log file with unused travel times (0=true, 1=false) reslog=1 # output log file with all travel time residuals (0=true, 1=false) twght=0 # weight travel times by pick quality (0=true, 1=false) xwt=1.0 # weight factor of smoothing in X direction ywt=1.0 # weight factor of smoothing in X direction zwt=1.0 # weight factor of smoothing in X direction # # Parameters for checkerboard tests # synthetic_anomaly=10.0 # magnitude of synthetic spike anomaly (in %) x_spike=4 # size of spike in X direction (in cells) y_spike=4 # size of spike in Y direction (in cells) z_spike=4 # size of spike in Z direction (in cells) x_buffer=4 # number of cells with 0 anomaly between spikes in X direction y_buffer=4 # number of cells with 0 anomaly between spikes in Y direction z_buffer=4 # number of cells with 0 anomaly between spikes in Z direction x_offset=0 # extra offset of skipes in X direction (in cells) y_offset=0 # extra offset of skipes in Y direction (in cells) z_offset=4 # extra offset of skipes in Z direction (in cells) # # GMT5 plotting parameters # start_layer=3 end_layer=20 paper_size=a4 cptdir=${HOME}/data/cpt p_cpt=$cptdir/16%_panoply.cpt s_cpt=$cptdir/16%_panoply.cpt vpvs_cpt=$cptdir/vpvs_drywet.cpt pc_cpt=$cptdir/hitc_20.cpt sc_cpt=$cptdir/hitc_20.cpt orientation=\"-P\" features=\"-Df -A10/1/1 -W0.5p -N2/0.5p,gray,- -L-17.72/28.48/$lat0/10\" include_plot=$topdir/geology/faults.sh xa=0.2 xt=0.1 xg=0 ya=0.2 yt=0.1 yg=0 axis=WeSn sta_symbol=\"-St0.15c -L -W0.25p,0/0/255\" sta_bad_symbol=\"-Si0.15c -L -G0\" eq_symbol=\"-Sc0.07c -L -W0.25p,255/0/0\" eq_bad_symbol=\"-Sc0.07c -L -W0.25p,255/100/255\" ex_symbol=\"-Sx0.07c -L -W0.25p,255/0/255\" gmt_verbose= # # vertical cross sections # dp=0.2 pwidth=10.0 offset=5.0 ha=10 ht=5 va=10 vt=5 p_cpt_absolute=$cptdir/vp_crimson3.cpt s_cpt_absolute=$cptdir/vs.cpt topo_cpt=$cptdir/dp5.cpt eq_symbol1=\"-Sc0.1c -L -W0.25p,255 -G0\" sta_symbol1=\"-Si0.2c -L -W0.25p -G255/0/255\"","title":"Example of a complete parameter file"}]}